#**unknowns.R**, the artifact analysis script
This script analyses patterns of occurances in amplicons that do not match any of the known allels present in samples. These can represent a number of PCR artifacts (e.g. polymeras induced SNP, polymerase slipage, chimeric amplicons from two diffrent allele templates), misscalls from the sequencing, unknown mutations in cell-lines or sexual/asexual recombinant allels, contamination from allels of strains not sequenced. The script was originally created to also identify true allels of strains that where lacking reference whole genome sequences, or reference genotyp amplicon sequences. This was done in an iterative fashion and these putative allels where identified and added to the database of known allels, and removed as unknown amplicon sequences in this data. Note that the script also incoorperate some of the output files from **Barcode_analysis.R** but it is not essential for the function of the script that this works, only for a few selected QC plots of read counts per sample. It does require that the **Indexing.txt** file is in its proper location from the **Barcode_analysis.R**. Overall the structure of files and the script structure is very simillar to **Barcode_analysis.R** .

#Houskeeping the loading packages####
Line 1-37 does houskeping, sets work directory, gives som Bash commands for prepping files with wrong name, loads packages etc.

#Process data#####
Line 40-46 reads in data.
Line 47-92 for-i-loop that indexes and merge the input data into one tall dataframe (XXX), as well as counting the reads per sample, plotting it,  and storing output these results into Read_counts and Indexed, and Plots directory.

#Read_count_summary#####
Line 85-336, reads in read count files that needs to manual created by UNIX command cat *.csv > ReadCount.txt. and cat *.csv > Unknown_counts.txt  in the two Read_counts directory. It then contrast the number of reads that mapp to the database of allele, versus those that do not, and makes diffrent graphical interpretations of this. This part of the script can be skipped without affecting downstream code,or modified for other data set.

#Find true unknown sequences#####
This part of the script uses the MasterMix, time zero mixtures of all strains, to identify abundant unknown sequences that may be true allels (already found and removed in our data) or artefacts that are so abundant they approch concentrations of true allels in samples.
Line 338-493 reads in mastermix samples for the two populations, and merge and filtere so that only amplicon seen in all samples of a population are retained. There is an option to search for sequences here. Graphical interpretations are made of the abundances of true allels are contrasted against unknowns. There is an option to manualy set the filtering of unknown reads based on mean abundance of reads across all replicates (Line 479). Some results files are outputed into Results directory. 

#High abundant reads across all samples####
This script catalogs all unknown amplicons and explores patterns in them across all samples.
Line 494-513 This script joins all the unknown amplicons across all samples which takes some time to do (20 min on my machine). It starts from the amplicons that where identified in the Mastermixes, and gives each new amplicon a running numerical ID from there on. So the first 700 are mastermix samples. The dataframe is saved and outputed into Results/Summary_all_unknow_allels_RA.txt, or alternatively accessed file from that point to skip this step.
Line 524-579 this adds upp observations of unknown amplicons and does filtering for the most abundant once (user changable). Some steps take a few minutes to run, and then it offers filtering options. This are based on sum of realativa abundance observations across samples, which is a bit abstract. The original scriped used raw counts, which can bias towards high coverage sample, but the names of the filterstep has retains this lie 557-559 (e.g. High_RA_means100 was, and is still roughly equivelent to more than 100 amplicons observed across all sampels). The numbers in the comments are based on raw read observations, whereas the script currently uses relative abundances. This can be modified early on in script, when reading in the Input data.
Line 579-697 This focuses on one filter category (currently amplicons seen more than sum of 0.1 fractions abundance, which could mean that ot is present at 10% in one sample or 0.1% in 100 samples: High_RA_means500), INdexes samples and generates plots of where these amplicons are seen,. The for-i-loop is prone to crashing on my machine, see alternative stop points #} to mitigate this.
Line 699-758 uses the High_RA_means500 filtered data, makes a indexed matrix and finaly a heatmap that clusters samples both based on occurence patterns across all samples, and also clusters samples based on occurences of amplicons. This shows which amplicons are linked across samples and presumably are related to artifacts from the genotype sample it is formed from. At least that is my interpretation of the data. Results matrixes are outputed into Results directory.

#Adapth the plots to the abundant Mastermix samples instead####
Line760-923 repeates the analysis (from Line 557-758) but focus only on the samples seen in high abundance in the Mastermixes/t0 samples. In the first iteration this was 124 amplicons above 20 reads per sample, but we have now annoterade some as real allels, and also changed the QC filtering of data so this number changes, and can be manual changed where "unknowns2" are filtered out (I set to 10 now to get more amplicons included, 93 now) and also on Line 760 where "MM_all" is filtered out (filter need to adjusted to N rows in "unknowns2") . Note that the indexing number is used to select these strains, and that the entire script need to be modified to change this subselection.  Results matrixes are outputed into Results directory.